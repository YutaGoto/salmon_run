name: Ruby

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    services:
      nginx:
        image: nginx
        ports:
        - 8080:80
      postgresql:
        image: postgresql
        ports:
        - 5432

    steps:
    - uses: actions/checkout@master
    - name: Set up Ruby 2.6
      uses: actions/setup-ruby@v1
      with:
        version: 2.6.x
    - name: Build
      run: |
        gem install bundler
        bundle install --jobs 4 --retry 3
        bundle exec rails db:create
        bundle exec rails db:schema:load
    - name: lint
      run: bundle exec rubocop
